# Антиплагиат (MVP версия, микросервисная система)

## Описание проекта

Система реализует сервис проверки студенческих контрольных работ на признаки плагиата.  
Архитектура построена на микросервисном подходе:

- каждый сервис отвечает за свою зону ответственности;
- у каждого сервиса есть собственная база данных;
- взаимодействие происходит через HTTP-запросы;
- вся система поднимается с помощью Docker Compose.

---

# Архитектура системы

Система состоит из трёх основных микросервисов:

---

## 1. FileStorageService

Отвечает за хранение файлов работ.

### Функциональность

- загрузка файла;
- сохранение файла в файловую систему контейнера;
- запись метаданных в PostgreSQL (имя файла, размер, дата загрузки);
- скачивание файла по `fileId`.

### Хранилище

- файлы → Docker volume `filestorage-files`;
- метаданные → PostgreSQL (`filestorage-db`).

---

## 2. FileAnalysisService

Проводит анализ работ и хранит результаты.

### Функциональность

- создание сущности `Work` (работа студента);
- скачивание файла по `fileId` из FileStorageService;
- вычисление хеша содержимого файла;
- определение плагиата:
    - работа считается плагиатом, если:
        - хеш файла совпадает с хешем уже существующей работы;
        - обе работы относятся к одному заданию (`assignmentId`);
        - авторы работ разные студенты (разные `studentId`);
        - сравниваемая работа была загружена раньше (`<work1>.SubmittedAt < <work2>.SubmittedAt`);
- создание `Report` (отчёт по проверке);
- возврат отчёта через API.

### Хранилище

- работы и отчёты → PostgreSQL (`fileanalysis-db`).

---

## 3. ApiGateway

Единая точка входа для внешних клиентов (студентов и преподавателей).

### Функциональность

- принимает файл от студента;
- вызывает FileStorageService и получает `fileId`;
- вызывает FileAnalysisService и получает `workId` и отчёт;
- возвращает итоговый результат клиенту:
    - идентификаторы работы и файла;
    - результат проверки на плагиат.

---

# Сценарии работы (User Flow)

## 1. Студент загружает работу

1. Студент отправляет запрос `POST /works/upload` в ApiGateway c параметрами:
    - `studentId` (GUID, можно сгенерировать онлайн);
    - `assignmentId` (GUID, можно сгенерировать онлайн);
    - `file` (файл работы (расширение файла любое)).
2. ApiGateway отправляет файл в FileStorageService:
    - файл сохраняется на диск;
    - в БД сохраняются метаданные;
    - сервис возвращает `fileId`.
3. ApiGateway отправляет запрос в FileAnalysisService:
    - передаёт `studentId`, `assignmentId`, `fileId`;
    - создаётся сущность `Work`;
    - файл скачивается из FileStorageService;
    - считается хеш файла;
    - выполняется поиск возможного плагиата;
    - создаётся `Report`.
4. ApiGateway возвращает клиенту JSON с полями:
    - `workId`;
    - `fileId`;
    - `isPlagiarism`;
    - `fileHash`;
    - `checkedAt`.

---

## 2. Преподаватель просматривает отчёты

1. Преподаватель знает `workId` работы.
2. Отправляет запрос `GET /works/{workId}/reports` в ApiGateway.
3. ApiGateway перенаправляет запрос в FileAnalysisService.
4. FileAnalysisService возвращает список отчётов по данной работе.
5. Преподаватель видит, является ли работа плагиатом и когда она была проверена.

---

# Запуск системы через Docker

## Требования

- установлен и запущен Docker Desktop;
- порты 8080, 8081, 8082, 5433, 5434 свободны.

## Запуск

Из корневой папки проекта (там, где лежит `docker-compose.yml`) выполнить:

    docker compose up --build

После успешного запуска будут доступны:

- ApiGateway Swagger:  
  http://localhost:8080/swagger
- FileStorageService Swagger:  
  http://localhost:8081/swagger
- FileAnalysisService Swagger:  
  http://localhost:8082/swagger

---

# Как тестировать систему

## 1. Тест загрузки работы (через ApiGateway)

1. Открыть в браузере:  
   http://localhost:8080/swagger
2. Найти метод:
    - `POST /works/upload`
3. Нажать `Try it out`.
4. Заполнить:
    - `studentId` — любой GUID;
    - `assignmentId` — любой GUID;
    - `file` — прикрепить файл с диска.
5. Нажать `Execute`.

В ответ вернётся JSON с результатом анализа:

- `workId`;
- `fileId`;
- `isPlagiarism`;
- `fileHash`;
- `checkedAt`.

---

## 2. Тест просмотра отчётов по работе

1. Скопировать `workId` из ответа предыдущего запроса (или любой другой workId загруженной ранее работы).
2. Найти метод:
    - `GET /works/{workId}/reports`
4. Нажать `Try it out`, подставить `workId`, нажать `Execute`.
5. Получить список отчётов по данной работе.

---

# Очистка данных

Чтобы остановить все контейнеры и полностью удалить данные (БД + файлы):

    docker compose down -v

---

# Используемые технологии

- C# / .NET 8;
- Entity Framework Core;
- PostgreSQL;
- Docker, Docker Compose;

---

# Автор

ФИО: Щербаков Денис 
Группа: БПИ249
